{%extends '../../base.html' %}

{%block title%}{{pageTitle}}{%endblock title%}

{%block content%}
<div class="row p-3">
    <p class="fs-1 align-middle">Informations</p>
</div>
<div class="row">
    <div class="col-lg-8">
        <div class="p-4 m-3 border rounded-3">
            <p class="fs-4">Informations mis en ligne :</p>
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th scope="col">Titre</th>
                        <th scope="col">Type</th>
                        <th scope="col">Affiché sur les écrans</th>
                        <th scope="col" class="d-none d-lg-block">Temps avant de se cacher</th>
                        
                    </tr>
                </thead>
                <tbody>
                    <tr class="information-row table-warning" id="id_information">
                        <td scope="row">Inscriptions</td>
                        <td>Urgente</td>
                        <td>Oui</td>
                        <td class="d-none d-lg-block">7 jours</td>
                    </tr>
                    <tr class="information-row">
                        <td scope="row">Le self</td>    
                        <td>Lambda</td>
                        <td>Non</td>
                        <td class="d-none d-lg-block">2 jours</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="col-lg-4">
        <div id="actions" class="border rounded-3 p-4 m-3">
            <p class="fs-4">Actions disponibles :</p>
            <button type="button" id="add" class="btn btn-primary mb-4" onclick="window.location = 'informations/ajouter'">
                + Ajouter une information
            </button>
            <h5>Information : <strong id="information-name">Aucun information sélectionné</strong></h5>
            <div id="actions-btn">
                <button type="button" id="edit" class="btn btn-outline-primary" onclick="window.location = 'informations/modifier?id=1'" disabled>Modifier</button>
                <button type="button" id="hide" class="btn btn-outline-warning" disabled>Cacher</button>
                <button type="button" id="delete" class="btn btn-danger" disabled>Supprimer</button>
            </div>
        </div>
        
    </div>
</div>
<script>
    window.addEventListener("DOMContentLoaded", () => {
        //Récupération des éléments DOM nécessaires
        var information = document.getElementsByClassName("information-row")

        //Association des lignes du tableau avec les différentes fonctions
        const informations = new Information(information)
        informations.associateInformationsFunctions()
    })
    
    function toggleActions(selected) {
        /*
        *   Fonction affichant les boutons quand l'utilisateur selectionne un information
        *   et qui modifie le bouton "Cacher/Afficher" en fonction de si l'information est actuellement
        *   à l'écran ou non
        */
        let informationName = document.getElementById("information-name")
        let buttons = document.getElementById("actions-btn").children
        
        //Modification du texte affichant le nom de l'information selectionné
        informationName.innerText = selected.children[0].innerText

        //Boucle s'executant à chaque fois que l'utilisateur sélectionne un information
        //Elle s'éxécute une fois pour chaque bouton d'action
        for(let i = 0; i < buttons.length; i++){
            buttons[i].disabled = false

            //Changement du texte du bouton affichant (ou non) l'information à l'écran et son style
            if(buttons[i].id == "hide" && selected.className.indexOf("table-warning") != -1){
                buttons[i].innerHTML = "Afficher"
                buttons[i].className = "btn btn-outline-success"

            } else if (buttons[i].id == "hide") {
                buttons[i].innerHTML = "Cacher"
                buttons[i].className = "btn btn-outline-warning"
            }
        }   
    }

    class Information {
        constructor(informations){
            this.informations = informations
            this.selected = undefined
        }

        associateInformationsFunctions(){
            /*
            *   Association de chaque ligne du tableau contenant les informations aux fonctions
            *   gérant les boutons et les lignes ditent "active" (sélectionné)
            */
            //Affectation de l'évenement "click" à chaque ligne du tableau contenant les informations
            for(let i = 0; i < this.informations.length ; i++){
                this.informations[i].addEventListener("click", () => {
                    this._toggleInformationActive(this.informations[i])
                    toggleActions(this.selected)
                })
            }
        }

        _toggleInformationActive(information){
            if(this.selected !== undefined){
                let classList = this.selected.classList.value.split(" ")
                classList.pop()
                this.selected.classList.value = classList.join(" ")
                        
            }
                    
            this.selected = information
            this.selected.classList.value += " table-active"
        }
    }

</script>
{%endblock content%}